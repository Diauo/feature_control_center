# 功能测试计划

## 1. 测试目标

确保用户认证和权限控制系统按设计要求正常工作，包括：
1. 用户认证功能（注册、登录、令牌管理）
2. JWT权限验证
3. 用户管理功能
4. 三层权限控制（超级管理员、客户经理、操作员）
5. 前端集成和权限控制

## 2. 测试环境

### 2.1 硬件环境
- 处理器：Intel i5或同等性能处理器
- 内存：8GB RAM
- 存储：至少10GB可用空间

### 2.2 软件环境
- 操作系统：Windows 10/11, macOS 10.15+, 或 Ubuntu 18.04+
- Python版本：3.8+
- Node.js版本：14.0+（用于前端开发）
- 数据库：SQLite（开发环境）
- 浏览器：Chrome 80+, Firefox 75+, Safari 13+

### 2.3 开发工具
- VS Code或同等IDE
- Postman或类似API测试工具
- 浏览器开发者工具

## 3. 测试策略

### 3.1 单元测试
- 测试用户模型和相关方法
- 测试JWT令牌生成和验证
- 测试权限验证逻辑
- 测试服务层功能

### 3.2 集成测试
- 测试API端点和权限控制
- 测试数据库操作和关联关系
- 测试前后端数据交互

### 3.3 端到端测试
- 测试完整的用户认证流程
- 测试不同角色用户的操作权限
- 测试前端界面和权限控制

## 4. 详细测试用例

### 4.1 用户认证测试

#### 4.1.1 用户注册
| 测试用例ID | 描述 | 输入 | 预期结果 |
|------------|------|------|----------|
| AUTH-001 | 正常注册 | 有效用户名、密码、邮箱 | 注册成功，返回用户信息 |
| AUTH-002 | 重复用户名 | 已存在的用户名 | 注册失败，返回错误信息 |
| AUTH-003 | 无效邮箱 | 无效邮箱格式 | 注册失败，返回错误信息 |
| AUTH-004 | 弱密码 | 短密码 | 注册失败，返回错误信息 |

#### 4.1.2 用户登录
| 测试用例ID | 描述 | 输入 | 预期结果 |
|------------|------|------|----------|
| AUTH-005 | 正常登录 | 正确用户名和密码 | 登录成功，返回JWT令牌 |
| AUTH-006 | 错误密码 | 正确用户名，错误密码 | 登录失败，返回错误信息 |
| AUTH-007 | 不存在用户 | 不存在的用户名 | 登录失败，返回错误信息 |
| AUTH-008 | 禁用用户 | 被禁用的用户凭据 | 登录失败，返回错误信息 |

#### 4.1.3 令牌管理
| 测试用例ID | 描述 | 输入 | 预期结果 |
|------------|------|------|----------|
| AUTH-009 | 刷新令牌 | 有效的刷新令牌 | 返回新的访问令牌 |
| AUTH-010 | 过期令牌 | 过期的访问令牌 | 返回401错误 |
| AUTH-011 | 无效令牌 | 无效的JWT令牌 | 返回401错误 |

### 4.2 权限控制测试

#### 4.2.1 超级管理员权限
| 测试用例ID | 描述 | 操作用户 | 操作对象 | 预期结果 |
|------------|------|----------|----------|----------|
| PERM-001 | 获取用户列表 | admin | 任意 | 成功获取用户列表 |
| PERM-002 | 创建用户 | admin | 新用户数据 | 成功创建用户 |
| PERM-003 | 更新用户 | admin | 任意用户 | 成功更新用户 |
| PERM-004 | 删除用户 | admin | 任意用户 | 成功删除用户 |
| PERM-005 | 管理所有功能 | admin | 任意功能 | 成功管理功能 |

#### 4.2.2 客户经理权限
| 测试用例ID | 描述 | 操作用户 | 操作对象 | 预期结果 |
|------------|------|----------|----------|----------|
| PERM-006 | 获取关联客户功能 | manager | 关联客户功能 | 成功获取功能列表 |
| PERM-007 | 获取非关联客户功能 | manager | 非关联客户功能 | 权限不足，返回403 |
| PERM-008 | 添加关联客户功能 | manager | 关联客户 | 成功添加功能 |
| PERM-009 | 添加非关联客户功能 | manager | 非关联客户 | 权限不足，返回403 |
| PERM-010 | 运行关联客户功能 | manager | 关联客户功能 | 成功运行功能 |
| PERM-011 | 运行非关联客户功能 | manager | 非关联客户功能 | 权限不足，返回403 |

#### 4.2.3 操作员权限
| 测试用例ID | 描述 | 操作用户 | 操作对象 | 预期结果 |
|------------|------|----------|----------|----------|
| PERM-012 | 获取关联客户功能 | operator | 关联客户功能 | 成功获取功能列表 |
| PERM-013 | 获取非关联客户功能 | operator | 非关联客户功能 | 权限不足，返回403 |
| PERM-014 | 添加功能 | operator | 任意 | 权限不足，返回403 |
| PERM-015 | 更新功能 | operator | 任意 | 权限不足，返回403 |
| PERM-016 | 删除功能 | operator | 任意 | 权限不足，返回403 |
| PERM-017 | 运行关联客户功能 | operator | 关联客户功能 | 成功运行功能 |
| PERM-018 | 运行非关联客户功能 | operator | 非关联客户功能 | 权限不足，返回403 |

### 4.3 用户管理测试

#### 4.3.1 用户增删改查
| 测试用例ID | 描述 | 操作用户 | 操作 | 预期结果 |
|------------|------|----------|------|----------|
| USER-001 | 创建用户 | admin | 提供完整用户信息 | 成功创建用户 |
| USER-002 | 获取用户列表 | admin | 无 | 返回用户列表 |
| USER-003 | 获取用户详情 | admin | 指定用户ID | 返回用户详情 |
| USER-004 | 更新用户信息 | admin | 提供更新信息 | 成功更新用户 |
| USER-005 | 删除用户 | admin | 指定用户ID | 成功删除用户 |

#### 4.3.2 客户关联管理
| 测试用例ID | 描述 | 操作用户 | 操作 | 预期结果 |
|------------|------|----------|------|----------|
| USER-006 | 设置客户经理关联客户 | admin | 关联客户列表 | 成功设置关联 |
| USER-007 | 更新客户经理关联客户 | admin | 新关联客户列表 | 成功更新关联 |
| USER-008 | 获取用户关联客户 | manager | 无 | 返回关联客户列表 |

### 4.4 前端集成测试

#### 4.4.1 登录流程
| 测试用例ID | 描述 | 操作 | 预期结果 |
|------------|------|------|----------|
| FE-001 | 正常登录流程 | 输入正确凭据 | 成功登录，跳转到主页 |
| FE-002 | 登录失败 | 输入错误凭据 | 显示错误信息，不跳转 |
| FE-003 | 未认证访问 | 直接访问受保护页面 | 重定向到登录页 |

#### 4.4.2 界面权限控制
| 测试用例ID | 描述 | 用户角色 | 操作 | 预期结果 |
|------------|------|----------|------|----------|
| FE-004 | 管理员界面显示 | admin | 访问主页 | 显示所有管理功能 |
| FE-005 | 客户经理界面显示 | manager | 访问主页 | 仅显示关联客户功能 |
| FE-006 | 操作员界面显示 | operator | 访问主页 | 仅显示运行功能 |

#### 4.4.3 数据过滤
| 测试用例ID | 描述 | 用户角色 | 操作 | 预期结果 |
|------------|------|----------|------|----------|
| FE-007 | 客户经理数据过滤 | manager | 查看功能列表 | 仅显示关联客户功能 |
| FE-008 | 操作员数据过滤 | operator | 查看功能列表 | 仅显示关联客户功能 |

## 5. 测试工具

### 5.1 后端测试
- 使用Python的unittest框架进行单元测试
- 使用Postman进行API测试
- 使用pytest进行集成测试

### 5.2 前端测试
- 使用Jest进行单元测试
- 使用Cypress进行端到端测试
- 使用浏览器开发者工具进行手动测试

## 6. 测试数据准备

### 6.1 测试用户
```json
[
  {
    "username": "admin",
    "password": "admin123",
    "role": "admin",
    "email": "admin@example.com"
  },
  {
    "username": "manager1",
    "password": "manager123",
    "role": "manager",
    "email": "manager1@example.com"
  },
  {
    "username": "manager2",
    "password": "manager123",
    "role": "manager",
    "email": "manager2@example.com"
  },
  {
    "username": "operator1",
    "password": "operator123",
    "role": "operator",
    "email": "operator1@example.com"
  },
  {
    "username": "operator2",
    "password": "operator123",
    "role": "operator",
    "email": "operator2@example.com"
  }
]
```

### 6.2 测试客户
```json
[
  {
    "name": "客户A",
    "description": "测试客户A"
  },
  {
    "name": "客户B",
    "description": "测试客户B"
  },
  {
    "name": "客户C",
    "description": "测试客户C"
  }
]
```

### 6.3 用户-客户关联
```json
[
  {
    "user_id": 2,
    "customer_id": 1
  },
  {
    "user_id": 2,
    "customer_id": 2
  },
  {
    "user_id": 3,
    "customer_id": 3
  },
  {
    "user_id": 4,
    "customer_id": 1
  },
  {
    "user_id": 5,
    "customer_id": 3
  }
]
```

## 7. 测试执行计划

### 7.1 第一阶段：单元测试（1天）
- 测试用户模型
- 测试JWT相关功能
- 测试权限验证逻辑

### 7.2 第二阶段：集成测试（2天）
- 测试API端点
- 测试数据库操作
- 测试服务层功能

### 7.3 第三阶段：端到端测试（2天）
- 测试完整的用户认证流程
- 测试不同角色用户的操作权限
- 测试前端界面和权限控制

### 7.4 第四阶段：回归测试（1天）
- 修复发现的问题后进行回归测试
- 验证所有功能正常工作

## 8. 测试通过标准

### 8.1 功能测试通过标准
- 所有测试用例执行通过率100%
- 无严重（Critical）和高（High）级别缺陷
- 中（Medium）级别缺陷不超过3个且不影响核心功能
- 低（Low）级别缺陷可以接受

### 8.2 性能测试通过标准
- 用户认证响应时间不超过2秒
- 权限验证响应时间不超过1秒
- 页面加载时间不超过3秒

### 8.3 安全测试通过标准
- 无权限绕过漏洞
- 无SQL注入漏洞
- 无XSS漏洞
- 密码存储符合安全要求

## 9. 风险评估

### 9.1 技术风险
- JWT令牌过期处理可能存在问题
- 权限验证逻辑可能存在漏洞
- 前后端数据同步可能不一致

### 9.2 时间风险
- 测试用例设计可能需要更多时间
- 缺陷修复可能影响测试进度
- 环境搭建可能遇到问题

### 9.3 资源风险
- 测试环境可能不稳定
- 测试数据可能不完整
- 测试工具可能不兼容

## 10. 测试交付物

### 10.1 测试报告
- 测试执行报告
- 缺陷报告
- 性能测试报告
- 安全测试报告

### 10.2 测试文档
- 测试用例文档
- 测试脚本
- 测试环境配置说明

### 10.3 测试数据
- 测试数据集
- 测试结果数据